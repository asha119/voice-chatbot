<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Voice Enabled AI Chatbot</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6f8;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .chat-container {
            width: 420px;
            background: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }

        h2 {
            text-align: center;
            margin-bottom: 10px;
        }

        #chat-box {
            height: 300px;
            border: 1px solid #ddd;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .user {
            text-align: right;
            color: #0b5ed7;
            margin: 5px 0;
        }

        .bot {
            text-align: left;
            color: #198754;
            margin: 5px 0;
        }

        input {
            width: 75%;
            padding: 8px;
        }

        button {
            padding: 8px 12px;
            margin-left: 5px;
            cursor: pointer;
        }

        .controls {
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>

<body>

<div class="chat-container">
    <h2>üé§ Voice Chatbot</h2>

    <div id="chat-box"></div>

    <div class="controls">
        <input type="text" id="user-input" placeholder="Ask your question..." />
        <button onclick="sendMessage()">Send</button>
        <button onclick="startVoice()">üéôÔ∏è</button>
    </div>
</div>

<script>
    let chatBox = document.getElementById("chat-box");

    function addMessage(sender, text) {
        let msg = document.createElement("div");
        msg.className = sender;
        msg.innerText = text;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    function speak(text) {
        window.speechSynthesis.cancel(); // stop old speech
        let speech = new SpeechSynthesisUtterance(text);
        speech.lang = "en-US";
        window.speechSynthesis.speak(speech);
    }

    function sendMessage() {
        let input = document.getElementById("user-input");
        let message = input.value.trim();
        if (message === "") return;

        addMessage("user", "You: " + message);
        input.value = "";

        fetch("/", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: "message=" + encodeURIComponent(message)
        })
        .then(res => res.json())
        .then(data => {
            addMessage("bot", "Bot: " + data.reply);
            speak(data.reply);   // speak latest reply
        })
        .catch(() => {
            addMessage("bot", "Bot: Server error");
        });
    }

    function startVoice() {
        let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = "en-US";

        recognition.onresult = function(event) {
            let voiceText = event.results[0][0].transcript;
            document.getElementById("user-input").value = voiceText;
            sendMessage();   // auto-send
        };

        recognition.start();
    }
</script>

</body>
</html>
